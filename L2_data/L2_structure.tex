\chapter{Level 2 Data Product Structure}
\label{chapter:L2_structure}

\section{Accesing Level 2 data}

L2 data can be obtained in two ways:

\begin{enumerate}

\item via a web-api that can be queried and used to get data from
  a specified area and time interval or from specific scans etc.
  Documentation about the web-api is found here: 
  \url{http://odin.rss.chalmers.se/apidocs/index.html} and
  \url{http://odin.rss.chalmers.se/dataaccess}

\item or through downloading monthly L2 product files files over http
  from a file archive (\url{http://odin.rss.chalmers.se/level2_download/}).
  \textbf{THIS IS NOT YET TRUE, BUT FILES WILL SOON BE FOUND HERE.}
  This option can preferable be used if all or a large part of the
  Odin data is of interest.

\end{enumerate}


\section{Available Level2 products}

A number of \smr\ Level2 products are available (\cite{dds}) and
a recommendadtion about what products to use is available
at \url{http://odin.rss.chalmers.se/dataaccess}.


\section{Level2 data description}

\subsection{Level2 file}

\subsubsection{File name convention}

L2 product files are stored in netCDF format (\url{https://www.unidata.ucar.edu/software/netcdf/})
and the file name convention of the monthly L2 files is: \\
Odin-SMR\_L2\_\{\textbf{project}\}\_\{\textbf{product}\}\_\{\textbf{year}\}-\{\textbf{month}:02\}.nc, \\
e.g.:\
Odin-SMR\_L2\_ALL-Strat-v3.0.0\_O3-501-GHz-20-to-50-km\_2005-01.nc.\\
where in this case:\\
project = ALL-Strat-v3.0.0 and product = O3-501-GHz-20-to-50-km.
See further in \cite{dds} for available projects and products.


\subsubsection{File content description}

Each L2 product is associated with a single scan of the atmosphere by the \smr\ instrument. In other words,
it describes a single VMR or temperature profile. It contains the objects described bellow: \\

% Question, to be discussed: is it better to provide the different fields in alphabetical order or to decide another logical order?
% (In any case, I think that the order of the description items below should be the same as the one of the L2 structure fields.)

\textbf{Altitude} (array of doubles): Altitude of retrieved values (m) \\

\textbf{Apriori} (array of doubles): \textit{A priori} profile used in the inversion algorithm ([-] or [K]). \\

\textbf{AVK} (2-D array of doubles): Averaging kernel matrix. For gas species, the averaging kernel for relative changes is given ([\%/\%]). For temperature, the unit is [K/K]. \\

\textbf{ErrorNoise} (array of doubles): Error due to measurement thermal noise (square root of the diagonal elements of the corresponding error matrix) ([-] or [K]). \\

\textbf{ErrorTotal} (array of doubles): Total retrieval error, corresponding to the error due to thermal noise and all interfering smoothing errors (square root of the diagonal elements of the corresponding error matrix) ([-] or [K]). \\

\textbf{FreqMode} (int): Odin/SMR observation frequency mode. \\ % Refer to a table giving all frequency modes with the corresponding frequency ranges and measured products. 

\textbf{Freq} (double): Center of the frequency band [GHz]. \\ % In order to be user-friendly, this should be always the same for one given frenquency mode, regardless of the spectral range actually used in the retrieval process. 

\textbf{Instrument} (string): Instrument name. \\ % Useful? To be discussed. 

\textbf{InvMode} (string): Inversion mode. \\ % ??

\textbf{Lat1D} (double): A scalar representative latitude of the retrieval [degrees north]. \\ % Say how it has been calculated (mean of 'Latitude'?)

\textbf{Latitude} (array of doubles): Approximate latitude of each retrieval value [degrees north]. \\

\textbf{Lon1D} (double): A scalar representative longitude of the retrieval [degrees east] \\ % Same comment as for 'Lat1D'.

\textbf{Longitude} (array of doubles): Approximate longitude of each retrieval value [degrees east]. \\

\textbf{LST} (double): Mean local solar time for the scan [hours]. \\ % Was not included in the previous version. Could make the data more user friendly. 

\textbf{MJD} (double): Mean modified julian date of the observations used in the retrieval process [days]. \\

\textbf{MeasResponse} (array of doubles): Measurement response, defined as the row sum of the averaging kernel matrix [-]. \\ % Refer to a document giving recommandations on how it should be used to filter the data.

\textbf{OrbitNum} (int): Odin/SMR orbit number. \\ % Useful? To be discussed.

\textbf{Pressure} (array of doubles): Pressure grid of the retrieved profile [Pa]. \\

\textbf{Product} (string): Level 2 product name. \\

\textbf{Profile} (array of doubles): Retrieved volume mixing ratio [-] or temperature [K] profile  \\ % I think this field should be called 'Profile' instead of 'VMR', in order to be consistent in the case of temperature profile retrieval.

\textbf{Quality} (int): Quality flag. \\ % To be discussed and defined. Give the definition of the flags in this document, and explain how they should be used to filter the data. 

\textbf{ScanID} (int): Satellite time word scan identifier. \\

\textbf{SZA1D} (double): Mean solar zenith angle of the observations used in the retrieval process [degrees]. \\

\textbf{SZA} (array of doubles): Approximate solar zenith angle corresponding to each retrieval value [degrees]. \\ % Should be provided? To be discussed. 

\textbf{Temperature} (array of doubles): Estimate of the temperature profile [K] (corresponding to the ZPT input data). \\ % Contrary to what is done in the internal L2 data, I think we should clearly distinguish the retrieved temperature profiles from the ones from the ZPT input. Only the zpt input should be given in this field. When a temperature profile is retrieved, it should be given in the 'Profile' field. Moreover, the source for the ZPT data should be clearly mentioned (either here, or add a reference to a document where the users can find this information).

\textbf{Theta} (array of doubles): Estimate of the potential temperature profile [K]. \\

\textbf{Time} (string): Mean time of the scan, given as 'YYYY-MM-DD-hh-mm-ss' \\ % Not necessary, as the information is already given in the MJD, but I think it can make the data more user friendly to give the time as a string, in addition to the MJD. 

\textbf{VersionL1b} (string): Version number of the Level 1b processing chain that was used to create the Level 1b data, in turn used as an input to the Level 2 processor. \\

\textbf{VersionL2} (string): Version number of the Level 2 processing chain that was used to create the Level 2 file. \\


\subsubsection{File format description}

A description of the L2 netCDF file is given below:

\begin{verbatim}

netcdf Odin-SMR_L2_ALL-Strat-v3.0.0_O3-501-GHz-20-to-50-km_2005-01 {
dimensions:
        time = 5 ;
        level = 28 ;
variables:
        float GenerationTime(time) ;
                GenerationTime:description = "Processing date." ;
                GenerationTime:units = "days since 1858-11-17 00:00" ;
        float Altitude(time, level) ;
                Altitude:description = "Altitude of retrieved values." ;
                Altitude:units = "m" ;
        float Apriori(time, level) ;
                Apriori:description = "A priori profile used in the
                    inversion algorithm." ;
                Apriori:units = "-" ;
        float AVK(time, level, level) ;
                AVK:description = "Averaging kernel matrix." ;
                AVK:units = "%/%" ;
        float ErrorNoise(time, level) ;
                ErrorNoise:description = "Error due to measurement ...";
                ErrorNoise:units = "-" ;
        float ErrorTotal(time, level) ;
                ErrorTotal:description = "Total retrieval error, ...";
                ErrorTotal:units = "-" ;
        float Lat1D(time) ;
                Lat1D:description = "A scalar representative latitude ...";
                Lat1D:units = "degrees north" ;
        float Latitude(time, level) ;
                Latitude:description = "Approximate latitude of each ...";
                Latitude:units = "degrees north" ;
        float Lon1D(time) ;
                Lon1D:description = "A scalar representative longitude ..." ;
                Lon1D:units = "degrees east" ;
        float Longitude(time, level) ;
                Longitude:description = "Approximate longitude of each ..." ;
                Longitude:units = "degrees east" ;
        float LST(time) ;
                LST:description = "Mean local solar time for the scan." ;
                LST:units = "hours" ;
        float MeasResponse(time, level) ;
                MeasResponse:description = "Measurement response, defined ..." ;
                MeasResponse:units = "-" ;
        float Orbit(time) ;
                Orbit:description = "Odin/SMR orbit number." ;
                Orbit:units = "-" ;
        float Pressure(time, level) ;
                Pressure:description = "Pressure grid of the retrieved ..." ;
                Pressure:units = "Pa" ;
        float Profile(time, level) ;
                Profile:description = "Retrieved volume mixing ratio." ;
                Profile:units = "-" ;
        int Quality(time) ;
                Quality:description = "Quality flag." ;
                Quality:units = "-" ;
        int64 ScanID(time) ;
                ScanID:description = "Satellite time word scan identifier." ;
                ScanID:units = "-" ;
        float SZA1D(time) ;
                SZA1D:description = "Mean solar zenith angle of the ..." ;
                SZA1D:units = "degrees" ;
        float SZA(time, level) ;
                SZA:description = "Approximate solar zenith angle ..." ;
                SZA:units = "degrees" ;
        float Temperature(time, level) ;
                Temperature:description = "Estimate of the temperature ..." ;
                Temperature:units = "K" ;
        float Theta(time, level) ;
                Theta:description = "Estimate of the potential temperature ..." ;
                Theta:units = "K" ;
        float Time(time) ;
                Time:description = "Mean time of the scan." ;
                Time:units = "days since 1858-11-17 00:00" ;

// global attributes:
                :observation_frequency_mode = 1LL ;
                :inversion_mode = "stnd" ;
                :level2_product_name = "O3 / 501 GHz / 20 to 50 km" ;
                :date_created = "2020-02-24 T08:31:04Z" ;
                :time_coverage_start = "2005-01-01 T11:12:13Z" ;
                :time_coverage_end = "2005-01-01 T11:30:58Z" ;
                :creator_name = "Donal Murtagh" ;
                :creator_url = "odin.rss.chalmers.se" ;
                :creator_email = "donal.murtagh@chalmers.se" ;
                :address = "412 96 Gothenburg, Sweden" ;
                :institution = "Chalmers University of Technology" ;
                :platform = "Odin" ;
                :sensor = "SMR" ;
                :version_l1b = "8" ;
                :version_l2 = "3.0.0" ;

}
\end{verbatim}


\subsection{Odin web-api}

The Level2 part of the Odin web-api contains a number of endpoints
(\url{http://odin.rss.chalmers.se/apidocs/index.html#/level2}),
that provides three different Level2 data objects denoted as
L2, L2i, and L2anc. The content of these three objects are described below.

\subsubsection{L2}
\input{../IODD/l2_format}
\subsubsection{L2i}
\input{../IODD/l2i_format}
\subsubsection{L2anc}

\begin{itemize}

    \item FreqMode (\emph{int}): \smr\ frequency mode of the observation
    \item InvMode (\emph{string}): Inversion mode
    \item LST (\emph{double}): Mean local solar time for the scan [hours].
    \item Lat1D (\emph{double}): A scalar representative latitude of
      the retrieval
    \item Latitude (\emph{array of doubles}): Approximate latitude of each
      retrieved value
    \item Lon1D (\emph{double}): A scalar representative longitude of
      the retrieval
    \item Longitude (\emph{array of doubles}): Approximate longitude of each
      retrieved value
    \item MJD (\emph{double}): Mean modified julian date of the observations
      used in the retrievel
    \item Orbit (\emph{double}): Orbit number
    \item Pressure (\emph{array of doubles}): Pressure grid of the retrieved
      species [Pa]
    \item SZA  (\emph{double}): Mean solar zenith angle of the observations
      used in the retrieval process [degrees]
    \item SZA1D (\emph{double}): Mean solar zenith angle of the observations
      used in the retrieval process [degrees]
    \item ScanID (\emph{int}): Satellite time word scan identifier
    \item Theta (\emph{array of doubles}): Estimate of the potential temperature
      profile [K]

\end{itemize}
